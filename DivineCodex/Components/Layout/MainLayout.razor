@using DivineCodex.Data
@using Microsoft.AspNetCore.Authorization
@using Microsoft.AspNetCore.Identity
@using Microsoft.EntityFrameworkCore.Metadata.Internal
@inherits LayoutComponentBase
@inject SignInManager<ApplicationUser> SignInManager
@inject NavigationManager NavigationManager
@attribute [Authorize]


<MudThemeProvider />
<MudPopoverProvider />
<MudDialogProvider />
<MudSnackbarProvider />

<MudLayout Class="layout-container">
    <MudAppBar Color="Color.Default" Elevation="2" Class="appbar">
        <MudIconButton Icon="@Icons.Material.Filled.Menu" Color="Color.Inherit" Edge="Edge.Start" OnClick="@DrawerToggle" />
        <MudText Typo="Typo.h5" Class="appbar-title">DivineCodex</MudText>
        <MudSpacer />
        <!-- New Post Button -->
        <MudButton Variant="Variant.Filled" Color="Color.Secondary" Class="new-post-button" >
            New Post
        </MudButton>

        <!-- Login and Register Buttons -->
        <button class="btn btn-danger" @onclick="Logout">Logout</button>
        <MudLink Href="account/login" Class="auth-link login-link">Login</MudLink>
        <MudText> / </MudText>
        <MudLink Href="account/register" Class="auth-link register-link">Register</MudLink>
        <MudIconButton Icon="@Icons.Material.Filled.Notifications" Color="Color.Inherit" />
        <MudAvatar Icon="@Icons.Material.Filled.AccountCircle" Class="user-avatar" />
    </MudAppBar>

    <MudDrawer @bind-Open="@_drawerOpen" Color="Color.Default" Class="drawer" Elevation="6">
        <!-- Main navigation section -->
        <MudNavLink Href="/" Match="NavLinkMatch.All" Class="nav-link">
            <MudIcon Icon="@Icons.Material.Filled.Home" />
            <span>Get Started</span>
        </MudNavLink>
        <MudNavLink Href="/dashboard" Class="nav-link">
            <MudIcon Icon="@Icons.Material.Filled.Dashboard" />
            <span>Dashboard</span>
        </MudNavLink>
        <MudNavLink Href="/leaderboard" Class="nav-link">
            <MudIcon Icon="@Icons.Material.Filled.Leaderboard" />
            <span>Leaderboard</span>
        </MudNavLink>
        <MudNavLink Href="/chat" Class="nav-link">
            <MudIcon Icon="@Icons.Material.Filled.Chat" />
            <span>Chat</span>
        </MudNavLink>
        <MudNavLink Href="/badgesandTitles" Class="nav-link">
            <MudIcon Icon="@Icons.Material.Filled.EmojiEvents" />
            <span>Badges & Titles</span>
        </MudNavLink>
        <MudNavLink Href="/referralSystem" Class="nav-link">
            <MudIcon Icon="@Icons.Material.Filled.GroupAdd" />
            <span>Referral System</span>
        </MudNavLink>
        <MudNavLink Href="/faq" Class="nav-link">
            <MudIcon Icon="@Icons.Material.Filled.QuestionAnswer" />
            <span>FAQ</span>
        </MudNavLink>
        
        <AuthorizeView Roles ="Admin">

        <!-- Admin Panel separated and hidden based on user role -->
            <MudDivider Class="admin-divider" />
            <MudNavLink Href="/admin" Class="admin-nav-link">
                <MudIcon Icon="@Icons.Material.Filled.AdminPanelSettings" />
                <span>Admin Panel</span>
            </MudNavLink>
        </AuthorizeView>

    </MudDrawer>

    <MudMainContent Class="main-content">
        @Body
    </MudMainContent>
</MudLayout>

<style>
    html, body {
        margin: 0;
        padding: 0;
        height: 100%;
        background-color: #f5f5f5; /* Light gray background */
    }

    .layout-container {
        height: 100vh;
        display: flex;
        flex-direction: column;
    }

    /* App bar */
    .appbar {
        background-color: #e1e1e1; /* Soft grayish-white */
        color: #333333; /* Dark text for contrast */
    }

    .appbar-title {
        font-weight: 600;
    }

    .user-avatar {
        margin-left: 8px;
    }

    /* Drawer */
    .drawer {
        background-color: #e0e0e0; /* Slightly darker gray */
        color: #333333;
    }

    .nav-link {
        display: flex;
        align-items: center;
        padding: 10px 16px;
        margin: 4px 8px;
        color: #4f4f4f;
        font-size: 14px;
        border-radius: 8px;
        text-decoration: none;
    }

        .nav-link:hover {
            background-color: #c7c7c7; /* Light gray hover */
            color: #FFFFFF;
        }

        .nav-link span {
            margin-left: 12px;
            font-size: 14px;
        }

    /* Admin Panel styling */
    .admin-nav-link {
        background-color: #d4d4d4; /* Lighter gray for admin */
        margin-top: 12px;
        padding: 10px;
        border-radius: 8px;
    }

        .admin-nav-link:hover {
            background-color: #a1a1a1; /* Darker gray hover */
        }

        .admin-nav-link span {
            color: #FFD700; /* Gold for Admin section */
        }

    .admin-divider {
        margin: 10px 0;
        border-top: 1px solid #333;
    }

    /* Main content */
    .main-content {
        background-color: #fafafa; /* Soft off-white background */
        color: #333333; /* Dark text for readability */
        padding: 20px;
        flex-grow: 1;
        overflow-y: auto;
        margin-top: 64px; /* Push content below the app bar */
        border-radius: 8px;
    }

    .mud-nav-link.active {
        background-color: #d6d6d6; /* Highlight active link */
        font-weight: bold;
        color: #333333;
    }

    /* New Post Button */
    .new-post-button {
        margin-right: 16px;
        padding: 10px 20px;
        border-radius: 8px;
        text-transform: none;
        font-weight: bold;
        background-color: #78909c; /* Soft grayish-blue */
        color: #fff;
    }

    /* General style for links */
    .auth-link {
        font-size: 16px;
        font-weight: 500;
        color: #2c3e50; /* Dark blue for professionalism */
        text-decoration: none;
        transition: all 0.3s ease-in-out; /* Smooth transition for hover effect */
        padding: 4px 8px;
        border-radius: 6px;
    }

        /* Hover effect */
        .auth-link:hover {
            color: #fff;
            background-color: #3498db; /* Light blue on hover */
            transform: translateY(-2px); /* Slight upward movement */
            box-shadow: 0px 4px 8px rgba(52, 152, 219, 0.2); /* Subtle shadow for depth */
        }

    /* For Login Link */
    .login-link {
        margin-right: 8px;
    }

    /* For Register Link */
    .register-link {
        margin-left: 8px;
    }

    /* Optional: Text separator style (slash) */
    .mud-text {
        font-size: 18px;
        color: #7f8c8d;
    }
</style>

@code {
    bool _drawerOpen = true;

    void DrawerToggle()
    {
        _drawerOpen = !_drawerOpen;
    }
    private async Task Logout()
    {
        await SignInManager.SignOutAsync();
        NavigationManager.NavigateTo("/"); // Redirect to the home or login page
    }
    
}
